# 🤖 Guide d'Automatisation - Import Twitter CityzenMag\n\n## 🎯 **Objectif**\nAutomatiser l'import quotidien des threads Twitter de @loi200812 pour maintenir le blog CityzenMag à jour automatiquement.\n\n## 📋 **Scripts Créés**\n\n### 1. **Import Complet** (`scripts/import-complet.sh`)\n- **Usage** : Import initial de tous les threads\n- **Fréquence** : Une fois (première synchronisation)\n- **Mode** : `full` avec limite 100 tweets\n- **Durée** : 2-5 minutes\n\n### 2. **Import Quotidien** (`scripts/import-quotidien.sh`)\n- **Usage** : Import quotidien du dernier thread\n- **Fréquence** : Tous les jours\n- **Mode** : `latest` avec limite 20 tweets\n- **Durée** : 10-30 secondes\n\n## ⏰ **Configuration Cron Job**\n\n### **1. Éditer le Crontab**\n```bash\ncrontab -e\n```\n\n### **2. Ajouter les Tâches Automatiques**\n```bash\n# Import quotidien CityzenMag - Tous les jours à 6h00\n0 6 * * * /bin/bash /home/grand-as/psagsn/custom_addons/cityzenmag/loi200812-blog/scripts/import-quotidien.sh >> /var/log/cityzenmag-import.log 2>&1\n\n# Import hebdomadaire complet - Dimanche à 2h00 (vérification)\n0 2 * * 0 /bin/bash /home/grand-as/psagsn/custom_addons/cityzenmag/loi200812-blog/scripts/import-complet.sh >> /var/log/cityzenmag-import-complet.log 2>&1\n```\n\n### **3. Vérifier la Configuration**\n```bash\n# Lister les tâches cron\ncrontab -l\n\n# Vérifier le service cron\nsudo systemctl status cron\n```\n\n## 📊 **Monitoring et Logs**\n\n### **1. Fichiers de Log**\n```bash\n# Log import quotidien\ntail -f /var/log/cityzenmag-import.log\n\n# Log import complet\ntail -f /var/log/cityzenmag-import-complet.log\n\n# Log système cron\nsudo tail -f /var/log/syslog | grep CRON\n```\n\n### **2. Vérification Manuelle**\n```bash\n# Test import quotidien\nbash scripts/import-quotidien.sh\n\n# Test import complet (attention: consomme quota API)\nbash scripts/import-complet.sh\n```\n\n## 🔔 **Notifications (Optionnel)**\n\n### **1. Notification par Email**\nAjouter à la fin des scripts :\n```bash\n# Envoyer email en cas de nouveau contenu\nif [ \"$NEW_THREADS\" -gt 0 ]; then\n    echo \"Nouveau thread importé: $TITLE\" | mail -s \"CityzenMag - Nouveau contenu\" admin@cityzenmag.com\nfi\n```\n\n### **2. Notification Slack/Discord**\n```bash\n# Webhook Slack\nif [ \"$NEW_THREADS\" -gt 0 ]; then\n    curl -X POST -H 'Content-type: application/json' \\\n        --data '{\"text\":\"🎉 Nouveau thread CityzenMag: '\"$TITLE\"'\"}' \\\n        YOUR_SLACK_WEBHOOK_URL\nfi\n```\n\n## 📈 **Dashboard de Monitoring**\n\n### **1. Script de Statut**\n```bash\n#!/bin/bash\n# scripts/status.sh\n\necho \"📊 Statut CityzenMag - $(date)\"\necho \"=================================\"\n\n# Statistiques base de données\nTHREADS=$(curl -s \"https://ghpptudzucrnygrozpht.supabase.co/rest/v1/threads?select=count\" \\\n    -H \"apikey: YOUR_KEY\" | jq -r '.[0].count')\necho \"Threads: $THREADS\"\n\n# Dernier import\nLAST_THREAD=$(curl -s \"https://ghpptudzucrnygrozpht.supabase.co/rest/v1/threads?select=date_created&order=created_at.desc&limit=1\" \\\n    -H \"apikey: YOUR_KEY\" | jq -r '.[0].date_created')\necho \"Dernier thread: $LAST_THREAD\"\n\n# Statut application\nif curl -s http://localhost:3002/ > /dev/null; then\n    echo \"Application: ✅ En ligne\"\nelse\n    echo \"Application: ❌ Hors ligne\"\nfi\n```\n\n### **2. Page de Statut Web**\nCréer une page `/admin/status` dans l'application pour :\n- Voir les statistiques en temps réel\n- Déclencher des imports manuels\n- Consulter les logs\n- Monitorer la santé du système\n\n## 🚨 **Gestion des Erreurs**\n\n### **1. Codes de Retour des Scripts**\n- `0` : Succès\n- `1` : Erreur API ou technique\n- `2` : Limite API atteinte (normal)\n\n### **2. Stratégie de Retry**\n```bash\n# Retry automatique en cas d'échec\nfor i in {1..3}; do\n    if bash scripts/import-quotidien.sh; then\n        break\n    else\n        echo \"Tentative $i échouée, retry dans 5min...\"\n        sleep 300\n    fi\ndone\n```\n\n### **3. Alertes Critiques**\n```bash\n# Alerte si pas d'import depuis 48h\nLAST_IMPORT=$(date -d \"$LAST_THREAD\" +%s)\nNOW=$(date +%s)\nDIFF=$(( (NOW - LAST_IMPORT) / 3600 ))\n\nif [ $DIFF -gt 48 ]; then\n    echo \"🚨 ALERTE: Pas d'import depuis ${DIFF}h\" | mail -s \"CityzenMag - Alerte\" admin@example.com\nfi\n```\n\n## 🔧 **Maintenance**\n\n### **1. Nettoyage des Logs**\n```bash\n# Rotation des logs (à ajouter au cron)\n0 0 1 * * find /var/log/cityzenmag-*.log -mtime +30 -delete\n```\n\n### **2. Sauvegarde Base de Données**\n```bash\n# Backup quotidien (à ajouter au cron)\n0 3 * * * pg_dump cityzenmag_db > /backup/cityzenmag_$(date +%Y%m%d).sql\n```\n\n### **3. Mise à Jour des Scripts**\n```bash\n# Vérifier les mises à jour\ncd /home/grand-as/psagsn/custom_addons/cityzenmag/loi200812-blog\ngit pull origin master\n```\n\n## 📋 **Checklist de Déploiement**\n\n### **Avant la Mise en Production**\n- [ ] Tester les scripts manuellement\n- [ ] Vérifier les permissions des fichiers\n- [ ] Configurer les logs\n- [ ] Tester le cron job\n- [ ] Vérifier l'espace disque\n- [ ] Configurer les alertes\n\n### **Après le Déploiement**\n- [ ] Surveiller les premiers imports\n- [ ] Vérifier la qualité des données\n- [ ] Tester les notifications\n- [ ] Documenter les procédures\n- [ ] Former l'équipe\n\n## 🎯 **Résultats Attendus**\n\n### **Import Quotidien**\n- **Fréquence** : Tous les jours à 6h00\n- **Contenu** : 0-1 nouveau thread par jour\n- **Durée** : 10-30 secondes\n- **Impact** : Blog toujours à jour\n\n### **Import Hebdomadaire**\n- **Fréquence** : Dimanche à 2h00\n- **Contenu** : Vérification complète\n- **Durée** : 2-5 minutes\n- **Impact** : Synchronisation de sécurité\n\n### **Monitoring**\n- **Logs** : Traçabilité complète\n- **Alertes** : Notification des problèmes\n- **Métriques** : Suivi de performance\n- **Dashboard** : Vue d'ensemble temps réel\n\n---\n\n## 🚀 **Commandes de Démarrage Rapide**\n\n```bash\n# 1. Test import quotidien\nbash scripts/import-quotidien.sh\n\n# 2. Configuration cron\ncrontab -e\n# Ajouter: 0 6 * * * /path/to/scripts/import-quotidien.sh\n\n# 3. Vérification\ncrontab -l\ntail -f /var/log/cityzenmag-import.log\n\n# 4. Monitoring\nbash scripts/status.sh\n```\n\n**L'automatisation est maintenant prête ! Le blog CityzenMag sera mis à jour automatiquement chaque matin avec les derniers threads de @loi200812.** 🎉🤖📊"
  }
]