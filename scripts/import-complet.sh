#!/bin/bash\n\n# Script d'import complet Twitter pour CityzenMag\n# Usage: bash scripts/import-complet.sh\n\necho \"üöÄ Import Complet Twitter - CityzenMag\"\necho \"===========================================\"\necho \"\"\n\n# Configuration\nSUPABASE_URL=\"https://ghpptudzucrnygrozpht.supabase.co\"\nANON_KEY=\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdocHB0dWR6dWNybnlncm96cGh0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MzYzODUsImV4cCI6MjA3MzIxMjM4NX0.nJgb0WAdzxeCmPuxb6ttatYdraLWyrA2-z89JAnXwc4\"\n\n# Fonction pour afficher les statistiques\nget_stats() {\n    local label=\"$1\"\n    echo \"üìä $label:\"\n    \n    THREADS=$(curl -s -X GET \"$SUPABASE_URL/rest/v1/threads?select=count\" \\\n        -H \"apikey: $ANON_KEY\" \\\n        -H \"Authorization: Bearer $ANON_KEY\" | jq -r '.[0].count // 0')\n    \n    TWEETS=$(curl -s -X GET \"$SUPABASE_URL/rest/v1/tweets?select=count\" \\\n        -H \"apikey: $ANON_KEY\" \\\n        -H \"Authorization: Bearer $ANON_KEY\" | jq -r '.[0].count // 0')\n    \n    MEDIA=$(curl -s -X GET \"$SUPABASE_URL/rest/v1/media_files?select=count\" \\\n        -H \"apikey: $ANON_KEY\" \\\n        -H \"Authorization: Bearer $ANON_KEY\" | jq -r '.[0].count // 0')\n    \n    echo \"   Threads: $THREADS\"\n    echo \"   Tweets: $TWEETS\"\n    echo \"   M√©dias: $MEDIA\"\n    echo \"\"\n}\n\n# Statistiques avant import\nget_stats \"Statut avant import\"\n\n# Test de connexion API\necho \"üîç Test de connexion API Twitter...\"\nTEST_RESULT=$(curl -s -X POST \"$SUPABASE_URL/functions/v1/twitter-sync\" \\\n    -H \"apikey: $ANON_KEY\" \\\n    -H \"Authorization: Bearer $ANON_KEY\" \\\n    -H \"Content-Type: application/json\" \\\n    -d '{\"mode\": \"latest\", \"limit\": 1}')\n\nif echo \"$TEST_RESULT\" | grep -q \"UsageCapExceeded\"; then\n    echo \"‚ùå Limite API Twitter atteinte\"\n    echo \"‚è≥ Veuillez attendre le reset de la limite (d√©but du mois)\"\n    echo \"\"\n    echo \"D√©tails:\"\n    echo \"$TEST_RESULT\" | jq .\n    exit 1\nfi\n\nif echo \"$TEST_RESULT\" | grep -q \"error\"; then\n    echo \"‚ùå Erreur API d√©tect√©e\"\n    echo \"$TEST_RESULT\" | jq .\n    exit 1\nfi\n\necho \"‚úÖ API Twitter accessible\"\necho \"\"\n\n# Import complet\necho \"üîÑ Lancement de l'import complet...\"\necho \"   Mode: full\"\necho \"   Limite: 100 tweets\"\necho \"   Cela peut prendre plusieurs minutes...\"\necho \"\"\n\nSTART_TIME=$(date +%s)\n\nIMPORT_RESULT=$(curl -s -X POST \"$SUPABASE_URL/functions/v1/twitter-sync\" \\\n    -H \"apikey: $ANON_KEY\" \\\n    -H \"Authorization: Bearer $ANON_KEY\" \\\n    -H \"Content-Type: application/json\" \\\n    -d '{\"mode\": \"full\", \"limit\": 100}')\n\nEND_TIME=$(date +%s)\nDURATION=$((END_TIME - START_TIME))\n\necho \"‚è±Ô∏è  Dur√©e: ${DURATION}s\"\necho \"\"\n\n# V√©rification du r√©sultat\nif echo \"$IMPORT_RESULT\" | grep -q \"error\"; then\n    echo \"‚ùå Erreur lors de l'import\"\n    echo \"$IMPORT_RESULT\" | jq .\n    exit 1\nfi\n\necho \"‚úÖ Import termin√© avec succ√®s!\"\necho \"\"\necho \"üìà R√©sultats de l'import:\"\necho \"$IMPORT_RESULT\" | jq .\necho \"\"\n\n# Statistiques apr√®s import\nget_stats \"Statut apr√®s import\"\n\n# Affichage des derniers threads import√©s\necho \"üßµ Derniers threads import√©s:\"\nLATEST_THREADS=$(curl -s -X GET \"$SUPABASE_URL/rest/v1/threads?select=thread_id,title,date_created,total_tweets&order=created_at.desc&limit=3\" \\\n    -H \"apikey: $ANON_KEY\" \\\n    -H \"Authorization: Bearer $ANON_KEY\")\n\necho \"$LATEST_THREADS\" | jq -r '.[] | \"   üìÑ \\(.title[0:60])...\\n      ID: \\(.thread_id)\\n      Date: \\(.date_created)\\n      Tweets: \\(.total_tweets)\\n\"'\n\necho \"üéâ Import complet termin√©!\"\necho \"üåê Consultez le site: http://localhost:3002/\"\necho \"\"\necho \"üìã Prochaines √©tapes:\"\necho \"   1. V√©rifier la qualit√© des donn√©es import√©es\"\necho \"   2. Configurer l'import quotidien automatique\"\necho \"   3. T√©l√©charger les m√©dias localement\"\necho \"   4. Optimiser les performances\""
  }
]