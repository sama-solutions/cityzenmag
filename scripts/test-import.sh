#!/bin/bash\n\n# Test d'import Twitter via curl\necho \"üöÄ Test d'import Twitter - Dernier thread\"\necho \"================================================\"\n\n# Configuration\nSUPABASE_URL=\"https://ghpptudzucrnygrozpht.supabase.co\"\nANON_KEY=\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdocHB0dWR6dWNybnlncm96cGh0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MzYzODUsImV4cCI6MjA3MzIxMjM4NX0.nJgb0WAdzxeCmPuxb6ttatYdraLWyrA2-z89JAnXwc4\"\n\n# Statut avant import\necho \"üìä Statut avant import:\"\nTHREADS_COUNT=$(curl -s -X GET \"$SUPABASE_URL/rest/v1/threads?select=count\" \\\n  -H \"apikey: $ANON_KEY\" \\\n  -H \"Authorization: Bearer $ANON_KEY\" \\\n  -H \"Content-Type: application/json\" | jq -r '.[0].count // 0')\n\necho \"   Threads actuels: $THREADS_COUNT\"\n\n# Lancement de l'import\necho \"\"\necho \"üîÑ Lancement de l'import du dernier thread...\"\nSTART_TIME=$(date +%s%3N)\n\nRESULT=$(curl -s -X POST \"$SUPABASE_URL/functions/v1/twitter-sync\" \\\n  -H \"apikey: $ANON_KEY\" \\\n  -H \"Authorization: Bearer $ANON_KEY\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"mode\": \"latest\", \"limit\": 20}')\n\nEND_TIME=$(date +%s%3N)\nDURATION=$((END_TIME - START_TIME))\n\necho \"‚è±Ô∏è  Dur√©e: ${DURATION}ms\"\necho \"\"\necho \"üìà R√©sultat de l'import:\"\necho \"$RESULT\" | jq .\n\n# Statut apr√®s import\necho \"\"\necho \"üìä Statut apr√®s import:\"\nNEW_THREADS_COUNT=$(curl -s -X GET \"$SUPABASE_URL/rest/v1/threads?select=count\" \\\n  -H \"apikey: $ANON_KEY\" \\\n  -H \"Authorization: Bearer $ANON_KEY\" \\\n  -H \"Content-Type: application/json\" | jq -r '.[0].count // 0')\n\necho \"   Threads: $NEW_THREADS_COUNT (+$((NEW_THREADS_COUNT - THREADS_COUNT)))\"\n\n# Dernier thread import√©\necho \"\"\necho \"üßµ Dernier thread import√©:\"\nLATEST_THREAD=$(curl -s -X GET \"$SUPABASE_URL/rest/v1/threads?select=*&order=created_at.desc&limit=1\" \\\n  -H \"apikey: $ANON_KEY\" \\\n  -H \"Authorization: Bearer $ANON_KEY\" \\\n  -H \"Content-Type: application/json\")\n\necho \"$LATEST_THREAD\" | jq -r '.[0] | \"   ID: \\(.thread_id)\\n   Titre: \\(.title)\\n   Date: \\(.date_created)\\n   Tweets: \\(.total_tweets)\"'\n\necho \"\"\necho \"üéâ Test termin√©!\""
  }
]